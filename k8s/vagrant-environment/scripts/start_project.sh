#!/bin/bash

#./project_envs.sh
helm upgrade --debug --wait --timeout=3000s --install $RELEASE_NAME ./chart -f values.yaml\
    --set core.db.backup.enabled.id=true\
    --set core.db.backup.aws.access.key.id=$DB_BACKUP_AWS_ACCESS_KEY_ID\
    --set core.db.backup.aws.secret.access.key=$DB_BACKUP_AWS_SECRET_ACCESS_KEY\
    --set core.db.backup.aws.default.region=$DB_BACKUP_AWS_DEFAULT_REGION\
    --set core.db.backup.aws.s3.bucket.name=$DB_BACKUP_AWS_S3_BUCKET_NAME\
    --set core.db.backup.aws.s3.bucket.backup.path=$DB_BACKUP_AWS_S3_BUCKET_BACKUP_PATH\
    --set core.db.backup.aws.s3.endpoint=$DB_BACKUP_AWS_S3_ENDPOINT\
    --set core.db.backup.slack.enabled=$DB_BACKUP_SLACK_ENABLED\
    --set core.db.backup.slack.channel=$DB_BACKUP_SLACK_CHANNEL\
    --set core.db.backup.slack.webhook.url=$DB_BACKUP_SLACK_WEBHOOK_URL\
    --set core.image.repository=$CI_REGISTRY_IMAGE/php\
    --set core.image.tag=$IMAGE_TAG\
    --set global.hostnameBase=$APP_HOSTNAME\
    --set global.hostnameAlias=$ALIAS_HOSTNAME\
    --set core.imagePullSecrets[0].name=gitlab-registry\
    --set core."podAnnotations.app\.gitlab\.com/env"=$CI_ENVIRONMENT_SLUG\
    --set core."podAnnotations.app\.gitlab\.com/app"=$CI_PROJECT_PATH_SLUG\
    --set core."commonAnnotations.app\.gitlab\.com/env"=$CI_ENVIRONMENT_SLUG\
    --set core."commonAnnotations.app\.gitlab\.com/app"=$CI_PROJECT_PATH_SLUG\
    --set core.mariadb.password=$MYSQL_PASSWORD\
    --set global.redis.password="$REDIS_PASSWORD"\
    --set core.rediscluster.password="$REDIS_PASSWORD}"\
    --set core.php.envs._GAME_API_ENDPOINT=$_GAME_API_ENDPOINT\
    --set core.php.envs.ENVIRONMENT=$CI_ENVIRONMENT_NAME\
    --set core.php.envs.SITE_URL=$SITE_URL\
    --set core.php.envs.COINPAYMENTS_MERCHANT_ID=$COINPAYMENTS_MERCHANT_ID\
    --set core.php.envs.COINPAYMENTS_PUBLIC_KEY=$COINPAYMENTS_PUBLIC_KEY\
    --set core.php.envs.APP_HOSTNAME=$_HOSTNAME\
    --set core.php.envs.APP_HTTPS=$APP_HTTPS\
    --set core.php.envs.ISOFTBET_LAUNCHER_URL=$ISOFTBET_LAUNCHER_URL\
    --set core.php.envs.ISOFTBET_LICENSEE_ID=$ISOFTBET_LICENSEE_ID\
    --set core.php.envs.ISOFTBET_OPERATOR=$ISOFTBET_OPERATOR\
    --set core.php.envs.ISOFTBET_GAMES_XML_DESKTOP=$ISOFTBET_GAMES_XML_DESKTOP\
    --set core.php.envs.ISOFTBET_GAMES_XML_MOBILE=$ISOFTBET_GAMES_XML_MOBILE\
    --set core.php.envs.PAYOP_PUBLIC_KEY=$PAYOP_PUBLIC_KEY\
    --set core.php.envs.PAYOP_TEST_MODE=$PAYOP_TEST_MODE\
    --set core.php.envs.REEVO_LAUNCHER_URL=$REEVO_LAUNCHER_URL\
    --set core.php.envs.REEVO_LICENSEE_ID=$REEVO_LICENSEE_ID\
    --set core.php.envs.REEVO_OPERATOR=$REEVO_OPERATOR\
    --set core.php.envs.REEVO_GAMES_XML_DESKTOP=$REEVO_GAMES_XML_DESKTOP\
    --set core.php.envs.REEVO_GAMES_XML_MOBILE=$REEVO_GAMES_XML_MOBILE\
    --set core.php.envs.TEST=yes\
    --set core.php.envs.MAIL_TYPE=$MAIL_TYPE\
    --set core.php.envs.MAIL_HOST=$MAIL_HOST\
    --set core.php.envs.MAIL_USERNAME=$MAIL_USERNAME\
    --set core.php.envs.S3_KEY=$S3_KEY\
    --set core.php.envs.S3_REGION=$S3_REGION\
    --set core.php.envs.S3_ENDPOINT=$S3_ENDPOINT\
    --set core.php.envs.S3_BUCKET=$S3_BUCKET\
    --set core.php.envs.INBET_URL=$INBET_URL\
    --set core.php.envs.RECAPTCHA_SITE_KEY=$RECAPTCHA_SITE_KEY\
    --set core.php.envs.SUN7PAY_USERNAME=$SUN7PAY_USERNAME\
    --set core.php.envs.XCEPTS_USERNAME=$XCEPTS_USERNAME\
    --set core.php.envs.XCEPTS_TEST_MODE=$XCEPTS_TEST_MODE\
    --set core.php.envs.POST_AFFILIATE_PRO_USERNAME=$POST_AFFILIATE_PRO_USERNAME\
    --set core.php.envs.MYSQL_HOSTNAME=$RELEASE_NAME-core-mariadb-galera\
    --set core.php.envs._GAME_API_ENDPOINT=$_GAME_API_ENDPOINT\
    --set core.php.secretEnvs.SITE_SECRET=$SITE_SECRET\
    --set core.php.secretEnvs.COINPAYMENTS_PRIVATE_KEY=$COINPAYMENTS_PRIVATE_KEY\
    --set core.php.secretEnvs.COINPAYMENTS_SECRET_KEY=$COINPAYMENTS_SECRET_KEY\
    --set core.php.secretEnvs.ISOFTBET_SECRET_KEY=$ISOFTBET_SECRET_KEY\
    --set core.php.secretEnvs.PAYOP_TOKEN=$PAYOP_TOKEN\
    --set core.php.secretEnvs.PAYOP_SECRET_KEY=$PAYOP_SECRET_KEY\
    --set core.php.secretEnvs.REEVO_SECRET_KEY=$REEVO_SECRET_KEY\
    --set core.php.secretEnvs.MAIL_PASSWORD=$MAIL_PASSWORD\
    --set core.php.secretEnvs.S3_SECRET=$S3_SECRET\
    --set core.php.secretEnvs.INBET_SECRET=$INBET_SECRET\
    --set core.php.secretEnvs.RECAPTCHA_SECRET_KEY=$RECAPTCHA_SECRET_KEY\
    --set core.php.secretEnvs.SUN7PAY_PASSWORD=$SUN7PAY_PASSWORD\
    --set core.php.secretEnvs.XCEPTS_PASSWORD=$XCEPTS_PASSWORD\
    --set core.php.secretEnvs.POST_AFFILIATE_PRO_PASSWORD=$POST_AFFILIATE_PRO_PASSWORD\
    --set core.php.oauth2TestClient=site\
    --set core.rediscluster.fullnameOverride=$RELEASE_NAME-core-redis-cluster\
    --set core.hostnameOverride=$_HOSTNAME\
    --set core.php.maintenance.mode.enabled=false\
    --set inbet.imagePullSecrets[0].name=gitlab-registry\
    --set inbet.image.tag=$INBET_TAG\
    --set inbet.mariadb.password=$MYSQL_PASSWORD\
    --set inbet.inbet.billingCode=$INBET_BILLING_CODE\
    --set inbet.inbet.salt=$INBET_SALT\
    --set inbet..oauth2Secret=$INBET_SECRET\
    --set inbet..url=$_URL\
    --set inbet."podAnnotations.app\.gitlab\.com/env"=$CI_ENVIRONMENT_SLUG\
    --set inbet."podAnnotations.app\.gitlab\.com/app"=$CI_PROJECT_PATH_SLUG\
    --set inbet."commonAnnotations.app\.gitlab\.com/env"=$CI_ENVIRONMENT_SLUG\
    --set inbet."commonAnnotations.app\.gitlab\.com/app"=$CI_PROJECT_PATH_SLUG\
    --set inbet.hostnameOverride=inbet-develop.ultrafair.com\
    --set global.Hostname=$_HOSTNAME\
    --set inbet.rpls.billingCode=$RPLS_BILLING_CODE\
    --set inbet.rpls.salt=$RPLS_SALT\
    --set core.mariadbgalera.rootUser.password=$MARIADB_ROOT_PASSWORD\
    --set core.mariadbgalera.galera.mariabackup.password=$MARIADB_GALERA_MARIABACKUP_PASSWORD\
    --set core.mariadbgalera.fullnameOverride=$RELEASE_NAME-core-mariadb-galera\
    --set core.mariadbgalera.db.user=$RELEASE_NAME-core\
    --set core.mariadbgalera.db.password=$MYSQL_PASSWORD\
    --set core.mariadbgalera.db.name=$RELEASE_NAME-core

